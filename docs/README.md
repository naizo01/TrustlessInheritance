# 相続アプリケーション設計概要

## 登場人物

- **Alice** は **Bob** に自分の資産を相続させたいと考えています。
- **Bob** は **Alice** から彼女の資産を相続することを希望しています。

## 証明パターンの比較

- ２つの証明方法があります。
- 初期設定時に、どちらの検証パターンを利用するか選ぶことができます。

| 項目               | ZK 証明を使用するパターン                             | 署名を使用するパターン                                 |
| ------------------ | ----------------------------------------------------- | ------------------------------------------------------ |
| **事前情報の共有** | Alice と Bob は秘密情報を事前に共有する必要がある     | 事前に Bob のアドレスが Alice に知られている必要がある |
| **検証方式**       | ZK 証明（Zero Knowledge Proof）でパートナー確認を行う | 署名によるパートナー確認を行う                         |
| **適用シナリオ**   | 相続者のアドレスを事前に知る必要がない場合に最適      | 相続者のアドレスが事前に判明している場合に最適         |

[コントラクトの詳細](contracts.md)

## 1. ZK を使った検証パターン（事前に受け取る側のアドレスがわかっていない場合）

### 1.1 **パートナー証明の確立**

- **Alice** と **Bob** は事前に秘密情報を共有します。この情報は、相続時に ZK 証明として使用されます。
- **Alice** は自分と Bob のアドレス、そして共有された秘密情報を使ってハッシュを生成し、スマートコントラクトに登録します。このハッシュは公開されますが、Bob のアドレスや秘密情報は秘匿されます。

### 1.2 **トークン転送許可の設定**

- Alice は、トークンの approve 設定をスマートコントラクトに対して行います。

### 1.3 **パートナー確認と死亡後のトークンロック**

- Alice が死亡したと見なされた場合、Bob は相続を開始します。Bob は秘密情報を元に ZK 証明（ZK proof）を生成し、その証明をスマートコントラクトに提出します。
- スマートコントラクトは ZK 証明を検証し、Alice が登録したハッシュと一致することを確認します。これにより Bob が正しい相続者であると証明されます。
- トークンはデフォルトで 3 ヶ月間ロックされ、その期間中は Alice が引き出すことも可能です。

### 1.4 **トークンの引き出し制限と解除**

- ロック期間終了後、Alice が引き出さなかった場合、システムは Alice が死亡したとみなします。
- ロック解除後、Bob はトークンを引き出すことが可能になります。不正な申請が行われた場合は、Alice が引き出すことで防ぐことができます。

![相続の流れzk](PairProof-相続の流れ.drawio.png)
